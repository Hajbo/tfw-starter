FROM python:3

COPY . /usr/src/app

WORKDIR /usr/src/app

ENV TFW_STARTER_WORKING_DIRECTORY=/tmp/starter          \
    TFW_STARTER_SOURCE_DIRECTORY=/usr/src/app/tfw
    
ENV TFW_STARTER_LANGUAGE_TEMPLATES_DIRECTORY="${TFW_STARTER_SOURCE_DIRECTORY}/starters" \
    TFW_STARTER_JINJA_TEMPLATES_DIRECTORY="${TFW_STARTER_SOURCE_DIRECTORY}/templates"

ENV TFW_STARTER_DOCKERFILE_SOURCE="${TFW_STARTER_JINJA_TEMPLATES_DIRECTORY}/Dockerfile.jinja2" \
    TFW_STARTER_SUPERVISOR_CONFIG_SOURCE="${TFW_STARTER_JINJA_TEMPLATES_DIRECTORY}/webservice.conf.jinja2" \
    TFW_STARTER_DOCKERFILE_DESTINATION="${TFW_STARTER_WORKING_DIRECTORY}}/solvable/Dockerfile" \
    TFW_STARTER_SUPERVISOR_CONFIG_DESTINATION="${TFW_STARTER_WORKING_DIRECTORY}/solvable/supervisor/webservice.conf"


RUN pip3 install -r requirements.txt

CMD ["python", "server.py"]